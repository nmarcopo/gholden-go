package grammar

import (
	"testing"

	"github.com/google/go-cmp/cmp"
	"github.com/stretchr/testify/require"
)

func Test_parser_Parse(t *testing.T) {
	tests := []struct {
		name string
		data []byte
		want ServerMessage
	}{
		{
			name: "one line",
			data: []byte(`|updateuser| Guest 60|0|1|{"blockChallenges":false,"blockPMs":false,"ignoreTickets":false,"hideBattlesFromTrainerCard":false,"blockInvites":false,"doNotDisturb":false,"blockFriendRequests":false,"allowFriendNotifications":false,"displayBattlesToFriends":false,"hideLogins":false,"hiddenNextBattle":false,"inviteOnlyNextBattle":false,"language":null}`),
			want: ServerMessage{Lines: []*Line{
				{Message: &Message{
					Command: "updateuser",
					Args:    ` Guest 60|0|1|{"blockChallenges":false,"blockPMs":false,"ignoreTickets":false,"hideBattlesFromTrainerCard":false,"blockInvites":false,"doNotDisturb":false,"blockFriendRequests":false,"allowFriendNotifications":false,"displayBattlesToFriends":false,"hideLogins":false,"hiddenNextBattle":false,"inviteOnlyNextBattle":false,"language":null}`,
				}},
			}},
		},
		{
			name: "multiple lines",
			data: []byte(`|updateuser| Guest 66|0|2|{"blockChallenges":false,"blockPMs":false,"ignoreTickets":false,"hideBattlesFromTrainerCard":false,"blockInvites":false,"doNotDisturb":false,"blockFriendRequests":false,"allowFriendNotifications":false,"displayBattlesToFriends":false,"hideLogins":false,"hiddenNextBattle":false,"inviteOnlyNextBattle":false,"language":null}
|customgroups|[{"symbol":"~","name":"Administrator","type":"leadership"},{"symbol":"#","name":"Room Owner","type":"leadership"},{"symbol":"★","name":"Host","type":"leadership"},{"symbol":"@","name":"Moderator","type":"staff"},{"symbol":"%","name":"Driver","type":"staff"},{"symbol":"*","name":"Bot","type":"normal"},{"symbol":"☆","name":"Player","type":"normal"},{"symbol":"+","name":"Voice","type":"normal"},{"symbol":"^","name":"Prize Winner","type":"normal"},{"symbol":"whitelist","name":"Whitelist","type":"normal"},{"symbol":" ","name":null,"type":"normal"},{"symbol":"‽","name":"Locked","type":"punishment"},{"symbol":"!","name":"Muted","type":"punishment"}]
|formats|,LL|,1|S/V Singles|[Gen 9] Random Battle,4f|[Gen 9] Unrated Random Battle,b|[Gen 9] Free-For-All Random Battle,7|[Gen 9] Random Battle (Blitz),4f|[Gen 9] Multi Random Battle,5|[Gen 9] OU,e|[Gen 9] Ubers,e|[Gen 9] UU,e|[Gen 9] RU,e|[Gen 9] NU,e|[Gen 9] PU,e|[Gen 9] LC,e|[Gen 9] Monotype,e|[Gen 9] CAP,e|[Gen 9] BSS Reg I,5c|[Gen 9] BSS Reg J,5e|[Gen 9] Custom Game,c|,1|S/V Doubles|[Gen 9] Random Doubles Battle,4f|[Gen 9] Doubles OU,e|[Gen 9] Doubles Ubers,e|[Gen 9] Doubles UU,e|[Gen 9] Doubles LC,c|[Gen 9] VGC 2023 Reg C,5c|[Gen 9] VGC 2023 Reg D,5c|[Gen 9] VGC 2024 Reg G,5c|[Gen 9] VGC 2025 Reg I,5c|[Gen 9] VGC 2025 Reg J,5e|[Gen 9] VGC 2025 Reg J (Bo3),1c|[Gen 9] VGC 2026 Reg F,5e|[Gen 9] VGC 2026 Reg F (Bo3),1e|[Gen 9] Doubles Custom Game,c|,1|Unofficial Metagames|[Gen 9] 1v1,e|[Gen 9] 2v2 Doubles,e|[Gen 9] Anything Goes,e|[Gen 9] Ubers UU,c|[Gen 9] ZU,e|[Gen 9] Free-For-All,6|[Gen 9] LC UU,c|[Gen 9] NFE,c|,1|Draft|[Gen 9] Draft,8c|[Gen 9] 6v6 Doubles Draft,8c|[Gen 9] 4v4 Doubles Draft,dc|[Gen 9] NatDex Draft,8c|[Gen 9] NatDex 6v6 Doubles Draft,8c|[Gen 9] NatDex LC Draft,8c|[Gen 8] Draft,c|[Gen 8] NatDex Draft,c|[Gen 8] NatDex 4v4 Doubles Draft,1c|[Gen 7] Draft,c|[Gen 6] Draft,c|[Gen 5] Draft,c|[Gen 4] Draft,c|[Gen 3] Draft,c|,2|OM of the Month|[Gen 9] Convergence,e|[Gen 9] VoltTurn Mayhem,e|,2|Other Metagames|[Gen 9] Almost Any Ability,e|[Gen 9] Balanced Hackmons,e|[Gen 9] Godly Gift,e|[Gen 9] Mix and Mega,e|[Gen 9] Shared Power,e|[Gen 9] STABmons,e|[Gen 7] Pure Hackmons,e|,2|Challengeable OMs|[Gen 9] 1-2 Switch,c|[Gen 9] 350 Cup,c|[Gen 9] Alphabet Cup,c|[Gen 9] Bad 'n Boosted,c|[Gen 9] Battlefields,c|[Gen 9] Camomons,c|[Gen 9] Category Swap,c|[Gen 9] Cross Evolution,c|[Gen 9] Fervent Impersonation,c|[Gen 9] Foresighters,c|[Gen 9] Formemons,c|[Gen 9] Fortemons,c|[Gen 9] Frantic Fusions,c|[Gen 9] Full Potential,c|[Gen 9] Inheritance,c|[Gen 9] Inverse,c|[Gen 9] Nature Swap,c|[Gen 9] Partners in Crime,c|[Gen 9] Passive Aggressive,c|[Gen 9] Pokebilities,c|[Gen 9] Pokemoves,c|[Gen 9] Pure Hackmons,c|[Gen 9] Relay Race,c|[Gen 9] Revelationmons,c|[Gen 9] Sharing is Caring,c|[Gen 9] Tera Donation,c|[Gen 9] Tera Override,c|[Gen 9] The Card Game,c|[Gen 9] The Loser's Game,c|[Gen 9] Tier Shift,c|[Gen 9] Trademarked,c|[Gen 9] Triples,c|[Gen 9] Type Split,c|[Gen 6] Pure Hackmons,c|,2|Temporary Tour Metas|[Gen 9] AAA Doubles,c|[Gen 9] AAA Ubers,c|[Gen 9] AAA UU,c|[Gen 8] Almost Any Ability,c|[Gen 8] Balanced Hackmons,c|[Gen 7] Balanced Hackmons,c|,2|National Dex|[Gen 9] National Dex,e|[Gen 8] National Dex,e|,2|National Dex Other Tiers|[Gen 9] National Dex 35 Pokes,c|[Gen 9] National Dex Ubers,e|[Gen 9] National Dex UU,e|[Gen 9] National Dex RU,c|[Gen 9] National Dex LC,c|[Gen 9] National Dex Monotype,e|[Gen 9] National Dex Doubles,e|[Gen 9] National Dex Doubles Ubers,e|[Gen 9] National Dex Ubers UU,c|[Gen 9] National Dex 1v1,c|[Gen 9] National Dex AG,c|[Gen 9] National Dex AAA,c|[Gen 9] National Dex BH,c|[Gen 9] National Dex Godly Gift,c|[Gen 9] National Dex STABmons,c|[Gen 8] National Dex UU,c|[Gen 8] National Dex RU,c|[Gen 8] National Dex Doubles,c|[Gen 8] National Dex Monotype,c|[Gen 8 DLC 1] National Dex AG,c|,2|Pet Mods|[Gen 9] Monster Hunter Random Battle,f|[Gen 9] Monster Hunter ServerMessage OU,c|[Gen 9] ChatBats,f|[Gen 9] Legends Z-A OU,e|,3|Randomized Format Spotlight|[Gen 9] Force of the Fallen Random Roulette,4f|,3|Randomized Metas|[Gen 9] Random Roulette,4f|[Gen 9] Monkey's Paw Random Battle,f|[Gen 9] Super Staff Bros Ultimate,4f|[Gen 9] Monotype Random Battle,4f|[Gen 9] Random Battle (Shared Power, B12P6),4f|[Gen 9] Random Battle Mayhem,4f|[Gen 9] Battle Factory,4f|[Gen 9] BSS Factory,5d|[Gen 9] Draft Factory,4d|[Gen 9] Baby Random Battle,4f|[Gen 9] Hackmons Cup,4f|[Gen 9] Doubles Hackmons Cup,4d|[Gen 9] Broken Cup,4f|[Gen 9] Challenge Cup 1v1,4f|[Gen 9] Challenge Cup 2v2,4f|[Gen 9] Challenge Cup 6v6,4d|[Gen 9] Metronome Battle,4e|[Gen 8] Random Battle,4f|[Gen 8] Random Doubles Battle,4d|[Gen 8] Free-For-All Random Battle,5|[Gen 8] Multi Random Battle,5|[Gen 8] Battle Factory,4d|[Gen 8] BSS Factory,5d|[Gen 8] Hackmons Cup,4d|[Gen 8] CAP 1v1,4d|[Gen 8 BDSP] Random Battle,4d|[Gen 7] Random Battle,4f|[Gen 7] Battle Factory,4d|[Gen 7] BSS Factory,5d|[Gen 7] Hackmons Cup,9|[Gen 7 Let's Go] Random Battle,4d|[Gen 6] Random Battle,4f|[Gen 6] Battle Factory,9|[Gen 5] Random Battle,4f|[Gen 4] Random Battle,4f|[Gen 3] Random Battle,4f|[Gen 2] Random Battle,4f|[Gen 1] Random Battle,4f|[Gen 1] Challenge Cup,9|[Gen 1] Hackmons Cup,9|,4|RoA Spotlight|[Gen 1] Ubers,e|[Gen 3] Orre Colosseum,4e|[Gen 6] VGC 2014,5e|,4|Past Gens OU|[Gen 8] OU,e|[Gen 7] OU,e|[Gen 6] OU,e|[Gen 5] OU,e|[Gen 4] OU,e|[Gen 3] OU,e|[Gen 2] OU,e|[Gen 1] OU,e|,4|Past Gens Doubles OU|[Gen 8] Doubles OU,e|[Gen 7] Doubles OU,e|[Gen 6] Doubles OU,e|[Gen 5] Doubles OU,c|[Gen 4] Doubles OU,c|[Gen 3] Doubles OU,c|,4|Sw/Sh Singles|[Gen 8] Ubers,c|[Gen 8] UU,c|[Gen 8] RU,c|[Gen 8] NU,c|[Gen 8] PU,c|[Gen 8] LC,c|[Gen 8] Monotype,c|[Gen 8] 1v1,c|[Gen 8] Anything Goes,c|[Gen 8] ZU,c|[Gen 8] CAP,c|[Gen 8] Battle Stadium Singles,5c|[Gen 8 BDSP] OU,c|[Gen 8 BDSP] Ubers,c|[Gen 8] Custom Game,c|,4|Sw/Sh Doubles|[Gen 8] Doubles Ubers,c|[Gen 8] Doubles UU,c|[Gen 8] VGC 2022,5c|[Gen 8] VGC 2021,5c|[Gen 8] VGC 2020,5c|[Gen 8 BDSP] Doubles OU,c|[Gen 8 BDSP] Battle Festival Doubles,1c|[Gen 8] Doubles Custom Game,c|,4|US/UM Singles|[Gen 7] Ubers,c|[Gen 7] UU,c|[Gen 7] RU,c|[Gen 7] NU,c|[Gen 7] PU,c|[Gen 7] LC,c|[Gen 7] Monotype,c|[Gen 7] 1v1,c|[Gen 7] Anything Goes,c|[Gen 7] ZU,c|[Gen 7] CAP,c|[Gen 7] Battle Spot Singles,5c|[Gen 7 Let's Go] OU,1c|[Gen 7] Custom Game,c|,4|US/UM Doubles|[Gen 7] Doubles UU,c|[Gen 7] VGC 2019,5c|[Gen 7] VGC 2018,5c|[Gen 7] VGC 2017,5c|[Gen 7] Battle Spot Doubles,5c|[Gen 7 Let's Go] Doubles OU,1c|[Gen 7] Doubles Custom Game,c|,4|OR/AS Singles|[Gen 6] Ubers,c|[Gen 6] UU,c|[Gen 6] RU,c|[Gen 6] NU,c|[Gen 6] PU,c|[Gen 6] LC,c|[Gen 6] Monotype,c|[Gen 6] 1v1,c|[Gen 6] Anything Goes,c|[Gen 6] ZU,c|[Gen 6] CAP,c|[Gen 6] Battle Spot Singles,5c|[Gen 6] Custom Game,c|,4|OR/AS Doubles/Triples|[Gen 6] VGC 2016,5c|[Gen 6] VGC 2015,5c|[Gen 6] Battle Spot Doubles,5c|[Gen 6] Doubles Custom Game,c|[Gen 6] Battle Spot Triples,1c|[Gen 6] Triples Custom Game,c|,4|B2/W2 Singles|[Gen 5] Ubers,c|[Gen 5] UU,c|[Gen 5] RU,c|[Gen 5] NU,c|[Gen 5] PU,c|[Gen 5] LC,c|[Gen 5] Monotype,c|[Gen 5] 1v1,c|[Gen 5] CAP,c|[Gen 5] ZU,c|[Gen 5] BW1 OU,c|[Gen 5] GBU Singles,5c|[Gen 5] Custom Game,c|,4|B2/W2 Doubles|[Gen 5] VGC 2013,5c|[Gen 5] VGC 2012,5c|[Gen 5] VGC 2011,5c|[Gen 5] Doubles Custom Game,c|[Gen 5] Triples Custom Game,c|,4|DPP Singles|[Gen 4] Ubers,c|[Gen 4] UU,c|[Gen 4] NU,c|[Gen 4] LC,c|[Gen 4] Anything Goes,c|[Gen 4] 1v1,c|[Gen 4] CAP,c|[Gen 4] PU,c|[Gen 4] ZU,c|[Gen 4] Custom Game,c|,4|DPP Doubles|[Gen 4] VGC 2010,5c|[Gen 4] VGC 2009,5c|[Gen 4] Doubles Custom Game,c|,4|Past Generations|[Gen 3] Ubers,c|[Gen 3] RU,c|[Gen 3] UU,c|[Gen 3] NU,c|[Gen 3] PU,c|[Gen 3] LC,c|[Gen 3] 1v1,c|[Gen 3] UUBL,c|[Gen 3] ZU,c|[Gen 3] ADV 200,c|[Gen 3] Custom Game,c|[Gen 3] Doubles Custom Game,c|[Gen 2] Ubers,c|[Gen 2] UU,c|[Gen 2] NU,c|[Gen 2] PU,c|[Gen 2] 1v1,c|[Gen 2] ZU,c|[Gen 2] NC 2000,4c|[Gen 2] Stadium OU,c|[Gen 2] Custom Game,c|[Gen 1] UU,c|[Gen 1] NU,c|[Gen 1] PU,c|[Gen 1] ZU,c|[Gen 1] LC,c|[Gen 1] 1v1,c|[Gen 1] Japanese OU,c|[Gen 1] Stadium OU,c|[Gen 1] Tradebacks OU,c|[Gen 1] NC 1997,4c|[Gen 1] Custom Game,c`),
			want: ServerMessage{Lines: []*Line{
				{Message: &Message{
					Command: "updateuser",
					Args:    ` Guest 66|0|2|{"blockChallenges":false,"blockPMs":false,"ignoreTickets":false,"hideBattlesFromTrainerCard":false,"blockInvites":false,"doNotDisturb":false,"blockFriendRequests":false,"allowFriendNotifications":false,"displayBattlesToFriends":false,"hideLogins":false,"hiddenNextBattle":false,"inviteOnlyNextBattle":false,"language":null}`,
				}},
				{Message: &Message{
					Command: "customgroups",
					Args:    `[{"symbol":"~","name":"Administrator","type":"leadership"},{"symbol":"#","name":"Room Owner","type":"leadership"},{"symbol":"★","name":"Host","type":"leadership"},{"symbol":"@","name":"Moderator","type":"staff"},{"symbol":"%","name":"Driver","type":"staff"},{"symbol":"*","name":"Bot","type":"normal"},{"symbol":"☆","name":"Player","type":"normal"},{"symbol":"+","name":"Voice","type":"normal"},{"symbol":"^","name":"Prize Winner","type":"normal"},{"symbol":"whitelist","name":"Whitelist","type":"normal"},{"symbol":" ","name":null,"type":"normal"},{"symbol":"‽","name":"Locked","type":"punishment"},{"symbol":"!","name":"Muted","type":"punishment"}]`,
				}},
				{Message: &Message{
					Command: "formats",
					Args:    `,LL|,1|S/V Singles|[Gen 9] Random Battle,4f|[Gen 9] Unrated Random Battle,b|[Gen 9] Free-For-All Random Battle,7|[Gen 9] Random Battle (Blitz),4f|[Gen 9] Multi Random Battle,5|[Gen 9] OU,e|[Gen 9] Ubers,e|[Gen 9] UU,e|[Gen 9] RU,e|[Gen 9] NU,e|[Gen 9] PU,e|[Gen 9] LC,e|[Gen 9] Monotype,e|[Gen 9] CAP,e|[Gen 9] BSS Reg I,5c|[Gen 9] BSS Reg J,5e|[Gen 9] Custom Game,c|,1|S/V Doubles|[Gen 9] Random Doubles Battle,4f|[Gen 9] Doubles OU,e|[Gen 9] Doubles Ubers,e|[Gen 9] Doubles UU,e|[Gen 9] Doubles LC,c|[Gen 9] VGC 2023 Reg C,5c|[Gen 9] VGC 2023 Reg D,5c|[Gen 9] VGC 2024 Reg G,5c|[Gen 9] VGC 2025 Reg I,5c|[Gen 9] VGC 2025 Reg J,5e|[Gen 9] VGC 2025 Reg J (Bo3),1c|[Gen 9] VGC 2026 Reg F,5e|[Gen 9] VGC 2026 Reg F (Bo3),1e|[Gen 9] Doubles Custom Game,c|,1|Unofficial Metagames|[Gen 9] 1v1,e|[Gen 9] 2v2 Doubles,e|[Gen 9] Anything Goes,e|[Gen 9] Ubers UU,c|[Gen 9] ZU,e|[Gen 9] Free-For-All,6|[Gen 9] LC UU,c|[Gen 9] NFE,c|,1|Draft|[Gen 9] Draft,8c|[Gen 9] 6v6 Doubles Draft,8c|[Gen 9] 4v4 Doubles Draft,dc|[Gen 9] NatDex Draft,8c|[Gen 9] NatDex 6v6 Doubles Draft,8c|[Gen 9] NatDex LC Draft,8c|[Gen 8] Draft,c|[Gen 8] NatDex Draft,c|[Gen 8] NatDex 4v4 Doubles Draft,1c|[Gen 7] Draft,c|[Gen 6] Draft,c|[Gen 5] Draft,c|[Gen 4] Draft,c|[Gen 3] Draft,c|,2|OM of the Month|[Gen 9] Convergence,e|[Gen 9] VoltTurn Mayhem,e|,2|Other Metagames|[Gen 9] Almost Any Ability,e|[Gen 9] Balanced Hackmons,e|[Gen 9] Godly Gift,e|[Gen 9] Mix and Mega,e|[Gen 9] Shared Power,e|[Gen 9] STABmons,e|[Gen 7] Pure Hackmons,e|,2|Challengeable OMs|[Gen 9] 1-2 Switch,c|[Gen 9] 350 Cup,c|[Gen 9] Alphabet Cup,c|[Gen 9] Bad 'n Boosted,c|[Gen 9] Battlefields,c|[Gen 9] Camomons,c|[Gen 9] Category Swap,c|[Gen 9] Cross Evolution,c|[Gen 9] Fervent Impersonation,c|[Gen 9] Foresighters,c|[Gen 9] Formemons,c|[Gen 9] Fortemons,c|[Gen 9] Frantic Fusions,c|[Gen 9] Full Potential,c|[Gen 9] Inheritance,c|[Gen 9] Inverse,c|[Gen 9] Nature Swap,c|[Gen 9] Partners in Crime,c|[Gen 9] Passive Aggressive,c|[Gen 9] Pokebilities,c|[Gen 9] Pokemoves,c|[Gen 9] Pure Hackmons,c|[Gen 9] Relay Race,c|[Gen 9] Revelationmons,c|[Gen 9] Sharing is Caring,c|[Gen 9] Tera Donation,c|[Gen 9] Tera Override,c|[Gen 9] The Card Game,c|[Gen 9] The Loser's Game,c|[Gen 9] Tier Shift,c|[Gen 9] Trademarked,c|[Gen 9] Triples,c|[Gen 9] Type Split,c|[Gen 6] Pure Hackmons,c|,2|Temporary Tour Metas|[Gen 9] AAA Doubles,c|[Gen 9] AAA Ubers,c|[Gen 9] AAA UU,c|[Gen 8] Almost Any Ability,c|[Gen 8] Balanced Hackmons,c|[Gen 7] Balanced Hackmons,c|,2|National Dex|[Gen 9] National Dex,e|[Gen 8] National Dex,e|,2|National Dex Other Tiers|[Gen 9] National Dex 35 Pokes,c|[Gen 9] National Dex Ubers,e|[Gen 9] National Dex UU,e|[Gen 9] National Dex RU,c|[Gen 9] National Dex LC,c|[Gen 9] National Dex Monotype,e|[Gen 9] National Dex Doubles,e|[Gen 9] National Dex Doubles Ubers,e|[Gen 9] National Dex Ubers UU,c|[Gen 9] National Dex 1v1,c|[Gen 9] National Dex AG,c|[Gen 9] National Dex AAA,c|[Gen 9] National Dex BH,c|[Gen 9] National Dex Godly Gift,c|[Gen 9] National Dex STABmons,c|[Gen 8] National Dex UU,c|[Gen 8] National Dex RU,c|[Gen 8] National Dex Doubles,c|[Gen 8] National Dex Monotype,c|[Gen 8 DLC 1] National Dex AG,c|,2|Pet Mods|[Gen 9] Monster Hunter Random Battle,f|[Gen 9] Monster Hunter ServerMessage OU,c|[Gen 9] ChatBats,f|[Gen 9] Legends Z-A OU,e|,3|Randomized Format Spotlight|[Gen 9] Force of the Fallen Random Roulette,4f|,3|Randomized Metas|[Gen 9] Random Roulette,4f|[Gen 9] Monkey's Paw Random Battle,f|[Gen 9] Super Staff Bros Ultimate,4f|[Gen 9] Monotype Random Battle,4f|[Gen 9] Random Battle (Shared Power, B12P6),4f|[Gen 9] Random Battle Mayhem,4f|[Gen 9] Battle Factory,4f|[Gen 9] BSS Factory,5d|[Gen 9] Draft Factory,4d|[Gen 9] Baby Random Battle,4f|[Gen 9] Hackmons Cup,4f|[Gen 9] Doubles Hackmons Cup,4d|[Gen 9] Broken Cup,4f|[Gen 9] Challenge Cup 1v1,4f|[Gen 9] Challenge Cup 2v2,4f|[Gen 9] Challenge Cup 6v6,4d|[Gen 9] Metronome Battle,4e|[Gen 8] Random Battle,4f|[Gen 8] Random Doubles Battle,4d|[Gen 8] Free-For-All Random Battle,5|[Gen 8] Multi Random Battle,5|[Gen 8] Battle Factory,4d|[Gen 8] BSS Factory,5d|[Gen 8] Hackmons Cup,4d|[Gen 8] CAP 1v1,4d|[Gen 8 BDSP] Random Battle,4d|[Gen 7] Random Battle,4f|[Gen 7] Battle Factory,4d|[Gen 7] BSS Factory,5d|[Gen 7] Hackmons Cup,9|[Gen 7 Let's Go] Random Battle,4d|[Gen 6] Random Battle,4f|[Gen 6] Battle Factory,9|[Gen 5] Random Battle,4f|[Gen 4] Random Battle,4f|[Gen 3] Random Battle,4f|[Gen 2] Random Battle,4f|[Gen 1] Random Battle,4f|[Gen 1] Challenge Cup,9|[Gen 1] Hackmons Cup,9|,4|RoA Spotlight|[Gen 1] Ubers,e|[Gen 3] Orre Colosseum,4e|[Gen 6] VGC 2014,5e|,4|Past Gens OU|[Gen 8] OU,e|[Gen 7] OU,e|[Gen 6] OU,e|[Gen 5] OU,e|[Gen 4] OU,e|[Gen 3] OU,e|[Gen 2] OU,e|[Gen 1] OU,e|,4|Past Gens Doubles OU|[Gen 8] Doubles OU,e|[Gen 7] Doubles OU,e|[Gen 6] Doubles OU,e|[Gen 5] Doubles OU,c|[Gen 4] Doubles OU,c|[Gen 3] Doubles OU,c|,4|Sw/Sh Singles|[Gen 8] Ubers,c|[Gen 8] UU,c|[Gen 8] RU,c|[Gen 8] NU,c|[Gen 8] PU,c|[Gen 8] LC,c|[Gen 8] Monotype,c|[Gen 8] 1v1,c|[Gen 8] Anything Goes,c|[Gen 8] ZU,c|[Gen 8] CAP,c|[Gen 8] Battle Stadium Singles,5c|[Gen 8 BDSP] OU,c|[Gen 8 BDSP] Ubers,c|[Gen 8] Custom Game,c|,4|Sw/Sh Doubles|[Gen 8] Doubles Ubers,c|[Gen 8] Doubles UU,c|[Gen 8] VGC 2022,5c|[Gen 8] VGC 2021,5c|[Gen 8] VGC 2020,5c|[Gen 8 BDSP] Doubles OU,c|[Gen 8 BDSP] Battle Festival Doubles,1c|[Gen 8] Doubles Custom Game,c|,4|US/UM Singles|[Gen 7] Ubers,c|[Gen 7] UU,c|[Gen 7] RU,c|[Gen 7] NU,c|[Gen 7] PU,c|[Gen 7] LC,c|[Gen 7] Monotype,c|[Gen 7] 1v1,c|[Gen 7] Anything Goes,c|[Gen 7] ZU,c|[Gen 7] CAP,c|[Gen 7] Battle Spot Singles,5c|[Gen 7 Let's Go] OU,1c|[Gen 7] Custom Game,c|,4|US/UM Doubles|[Gen 7] Doubles UU,c|[Gen 7] VGC 2019,5c|[Gen 7] VGC 2018,5c|[Gen 7] VGC 2017,5c|[Gen 7] Battle Spot Doubles,5c|[Gen 7 Let's Go] Doubles OU,1c|[Gen 7] Doubles Custom Game,c|,4|OR/AS Singles|[Gen 6] Ubers,c|[Gen 6] UU,c|[Gen 6] RU,c|[Gen 6] NU,c|[Gen 6] PU,c|[Gen 6] LC,c|[Gen 6] Monotype,c|[Gen 6] 1v1,c|[Gen 6] Anything Goes,c|[Gen 6] ZU,c|[Gen 6] CAP,c|[Gen 6] Battle Spot Singles,5c|[Gen 6] Custom Game,c|,4|OR/AS Doubles/Triples|[Gen 6] VGC 2016,5c|[Gen 6] VGC 2015,5c|[Gen 6] Battle Spot Doubles,5c|[Gen 6] Doubles Custom Game,c|[Gen 6] Battle Spot Triples,1c|[Gen 6] Triples Custom Game,c|,4|B2/W2 Singles|[Gen 5] Ubers,c|[Gen 5] UU,c|[Gen 5] RU,c|[Gen 5] NU,c|[Gen 5] PU,c|[Gen 5] LC,c|[Gen 5] Monotype,c|[Gen 5] 1v1,c|[Gen 5] CAP,c|[Gen 5] ZU,c|[Gen 5] BW1 OU,c|[Gen 5] GBU Singles,5c|[Gen 5] Custom Game,c|,4|B2/W2 Doubles|[Gen 5] VGC 2013,5c|[Gen 5] VGC 2012,5c|[Gen 5] VGC 2011,5c|[Gen 5] Doubles Custom Game,c|[Gen 5] Triples Custom Game,c|,4|DPP Singles|[Gen 4] Ubers,c|[Gen 4] UU,c|[Gen 4] NU,c|[Gen 4] LC,c|[Gen 4] Anything Goes,c|[Gen 4] 1v1,c|[Gen 4] CAP,c|[Gen 4] PU,c|[Gen 4] ZU,c|[Gen 4] Custom Game,c|,4|DPP Doubles|[Gen 4] VGC 2010,5c|[Gen 4] VGC 2009,5c|[Gen 4] Doubles Custom Game,c|,4|Past Generations|[Gen 3] Ubers,c|[Gen 3] RU,c|[Gen 3] UU,c|[Gen 3] NU,c|[Gen 3] PU,c|[Gen 3] LC,c|[Gen 3] 1v1,c|[Gen 3] UUBL,c|[Gen 3] ZU,c|[Gen 3] ADV 200,c|[Gen 3] Custom Game,c|[Gen 3] Doubles Custom Game,c|[Gen 2] Ubers,c|[Gen 2] UU,c|[Gen 2] NU,c|[Gen 2] PU,c|[Gen 2] 1v1,c|[Gen 2] ZU,c|[Gen 2] NC 2000,4c|[Gen 2] Stadium OU,c|[Gen 2] Custom Game,c|[Gen 1] UU,c|[Gen 1] NU,c|[Gen 1] PU,c|[Gen 1] ZU,c|[Gen 1] LC,c|[Gen 1] 1v1,c|[Gen 1] Japanese OU,c|[Gen 1] Stadium OU,c|[Gen 1] Tradebacks OU,c|[Gen 1] NC 1997,4c|[Gen 1] Custom Game,c`,
				}},
			}},
		},
		{
			name: "popup",
			data: []byte(`|popup|You tried to send \"testing123\" to the room \"lobby\" but it failed because you were not in that room.`),
			want: ServerMessage{Lines: []*Line{
				{Message: &Message{
					Command: "popup",
					Args:    `You tried to send \"testing123\" to the room \"lobby\" but it failed because you were not in that room.`,
				}},
			}},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			parsed, err := ShowdownParser.Parse(tt.data)
			require.NoError(t, err, Pretty(err))
			if diff := cmp.Diff(tt.want, parsed); diff != "" {
				t.Errorf("Parse() mismatch (-want +got):\n%s", diff)
			}
		})
	}
}
